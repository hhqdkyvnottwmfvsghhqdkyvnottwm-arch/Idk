-- Advanced Mini GUI V3 - Made by Roblox Hacks 404
-- Powerful Edition with Bypass & Error Fixes

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local LocalPlayer = Players.LocalPlayer

-- Create the main frame
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "PowerfulMiniGUI_V3"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 400, 0, 450) -- Increased size for new features
MainFrame.Position = UDim2.new(0.5, -200, 0.5, -175)
MainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
MainFrame.BorderSizePixel = 0
MainFrame.BackgroundTransparency = 0.1
MainFrame.Active = true
MainFrame.Draggable = true
MainFrame.Parent = ScreenGui

-- Add gradient effect
local Gradient = Instance.new("UIGradient")
Gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(45, 45, 45)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(25, 25, 25))
})
Gradient.Rotation = 45
Gradient.Parent = MainFrame

-- Create title bar
local TitleBar = Instance.new("Frame")
TitleBar.Name = "TitleBar"
TitleBar.Size = UDim2.new(1, 0, 0, 30)
TitleBar.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
TitleBar.BorderSizePixel = 0
TitleBar.Parent = MainFrame

local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, -80, 1, 0)
Title.BackgroundTransparency = 1
Title.Text = "‚ö° POWERFUL V3 - Roblox Hacks 404 ‚ö°"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Font = Enum.Font.GothamBold
Title.TextSize = 14
Title.Parent = TitleBar

-- Create control buttons
local CloseButton = Instance.new("TextButton")
CloseButton.Name = "CloseButton"
CloseButton.Size = UDim2.new(0, 30, 0, 30)
CloseButton.Position = UDim2.new(1, -30, 0, 0)
CloseButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
CloseButton.BorderSizePixel = 0
CloseButton.Text = "X"
CloseButton.TextColor3 = Color3.fromRGB(255, 255, 255)
CloseButton.Font = Enum.Font.GothamBold
CloseButton.TextSize = 14
CloseButton.Parent = TitleBar

local HideButton = Instance.new("TextButton")
HideButton.Name = "HideButton"
HideButton.Size = UDim2.new(0, 30, 0, 30)
HideButton.Position = UDim2.new(1, -60, 0, 0)
HideButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
HideButton.BorderSizePixel = 0
HideButton.Text = "_"
HideButton.TextColor3 = Color3.fromRGB(255, 255, 255)
HideButton.Font = Enum.Font.GothamBold
HideButton.TextSize = 14
HideButton.Parent = TitleBar

-- Create content area
local Content = Instance.new("Frame")
Content.Name = "Content"
Content.Size = UDim2.new(1, 0, 1, -30)
Content.Position = UDim2.new(0, 0, 0, 30)
Content.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
Content.BorderSizePixel = 0
Content.BackgroundTransparency = 0.1
Content.Parent = MainFrame

-- Create scrolling frame for buttons
local ScrollFrame = Instance.new("ScrollingFrame")
ScrollFrame.Size = UDim2.new(1, 0, 1, 0)
ScrollFrame.BackgroundTransparency = 1
ScrollFrame.BorderSizePixel = 0
ScrollFrame.ScrollBarThickness = 4
ScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 600)
ScrollFrame.Parent = Content

-- Create UIListLayout for buttons
local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Padding = UDim.new(0, 8)
UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Parent = ScrollFrame

-- Create padding
local UIPadding = Instance.new("UIPadding")
UIPadding.PaddingTop = UDim.new(0, 10)
UIPadding.PaddingBottom = UDim.new(0, 10)
UIPadding.Parent = ScrollFrame

-- Function to create stylish buttons
local function createButton(name, text, layoutOrder, color)
    local button = Instance.new("TextButton")
    button.Name = name
    button.Size = UDim2.new(0, 350, 0, 45)
    button.BackgroundColor3 = color
    button.BorderSizePixel = 0
    button.Text = text
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Font = Enum.Font.GothamBold
    button.TextSize = 14
    button.LayoutOrder = layoutOrder
    button.AutoButtonColor = false
    
    -- Add hover effects
    local function hoverEffect(hovering)
        local targetColor = hovering and Color3.fromRGB(
            math.min(color.R * 255 + 30, 255),
            math.min(color.G * 255 + 30, 255),
            math.min(color.B * 255 + 30, 255)
        ) or color
        
        local tweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local tween = TweenService:Create(button, tweenInfo, {BackgroundColor3 = targetColor})
        tween:Play()
    end
    
    button.MouseEnter:Connect(function()
        hoverEffect(true)
    end)
    
    button.MouseLeave:Connect(function()
        hoverEffect(false)
    end)
    
    button.Parent = ScrollFrame
    return button
end

-- Create buttons
local SpeedButton = createButton("SpeedButton", "üöÄ Speed Hack: OFF", 1, Color3.fromRGB(80, 120, 200))
local JumpButton = createButton("JumpButton", "üîÑ Infinite Jump: OFF", 2, Color3.fromRGB(80, 120, 200))
local FlyButton = createButton("FlyButton", "‚úàÔ∏è Fly Mode: OFF", 3, Color3.fromRGB(80, 120, 200))
local NoclipButton = createButton("NoclipButton", "üëª Noclip: OFF", 4, Color3.fromRGB(120, 80, 200))
local BypassButton = createButton("BypassButton", "üõ°Ô∏è Anti-Cheat Bypass: OFF", 5, Color3.fromRGB(200, 100, 50))
local MorphTowerButton = createButton("MorphTowerButton", "üè∞ Load Morph Tower Script", 6, Color3.fromRGB(200, 120, 80))
local LoadButton = createButton("LoadButton", "üìÇ Load External Script", 7, Color3.fromRGB(120, 80, 200))
local ESPButton = createButton("ESPButton", "üëÅÔ∏è Player ESP: OFF", 8, Color3.fromRGB(80, 200, 120))

-- Create status label
local StatusLabel = Instance.new("TextLabel")
StatusLabel.Name = "StatusLabel"
StatusLabel.Size = UDim2.new(0, 350, 0, 30)
StatusLabel.Position = UDim2.new(0.5, -175, 1, -35)
StatusLabel.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
StatusLabel.BorderSizePixel = 0
StatusLabel.Text = "Status: Ready | V3 Powerful Edition"
StatusLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.TextSize = 12
StatusLabel.Parent = Content

-- Create hidden frame
local HiddenFrame = Instance.new("Frame")
HiddenFrame.Name = "HiddenFrame"
HiddenFrame.Size = UDim2.new(0, 200, 0, 30)
HiddenFrame.Position = UDim2.new(0, 10, 0, 10)
HiddenFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
HiddenFrame.BorderSizePixel = 0
HiddenFrame.Visible = false
HiddenFrame.Parent = ScreenGui

local ShowButton = Instance.new("TextButton")
ShowButton.Name = "ShowButton"
ShowButton.Size = UDim2.new(1, 0, 1, 0)
ShowButton.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
ShowButton.BorderSizePixel = 0
ShowButton.Text = "‚ö° V3 GUI - Click to Show"
ShowButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ShowButton.Font = Enum.Font.GothamBold
ShowButton.TextSize = 12
ShowButton.Parent = HiddenFrame

-- Button functionality
CloseButton.MouseButton1Click:Connect(function()
    ScreenGui:Destroy()
end)

local isHidden = false
HideButton.MouseButton1Click:Connect(function()
    isHidden = true
    MainFrame.Visible = false
    HiddenFrame.Visible = true
end)

ShowButton.MouseButton1Click:Connect(function()
    isHidden = false
    MainFrame.Visible = true
    HiddenFrame.Visible = false
end)

-- Feature variables
local speedEnabled = false
local jumpEnabled = false
local flyEnabled = false
local noclipEnabled = false
local bypassEnabled = false
local espEnabled = false
local flySpeed = 100 -- Increased fly speed
local bv = nil
local bg = nil
local noclipConnection = nil
local espHighlight = {}

-- Safe character function
local function getSafeCharacter()
    local character = LocalPlayer.Character
    if character and character:FindFirstChild("Humanoid") and character.Humanoid.Health > 0 then
        return character
    end
    return nil
end

-- Bypass function
local function enableBypass()
    if bypassEnabled then return end
    
    bypassEnabled = true
    BypassButton.Text = "üõ°Ô∏è Anti-Cheat Bypass: ON"
    BypassButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
    StatusLabel.Text = "Status: Anti-Cheat Bypass Active"
    
    -- Multiple bypass methods
    pcall(function()
        -- Method 1: Disable various checks
        if getSafeCharacter() then
            local humanoid = getSafeCharacter().Humanoid
            humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
            humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
        end
        
        -- Method 2: Hook metatables (advanced bypass)
        local oldNamecall
        oldNamecall = hookmetamethod(game, "__namecall", function(self, ...)
            local method = getnamecallmethod()
            if method == "Kick" or method == "kick" then
                return nil
            end
            return oldNamecall(self, ...)
        end)
        
        -- Method 3: Protect important instances
        for _, conn in pairs(getconnections(LocalPlayer.Idled)) do
            conn:Disable()
        end
    end)
end

-- Noclip function
local function enableNoclip()
    if noclipEnabled then return end
    
    noclipEnabled = true
    NoclipButton.Text = "üëª Noclip: ON"
    NoclipButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
    
    noclipConnection = RunService.Stepped:Connect(function()
        if noclipEnabled and getSafeCharacter() then
            for _, part in pairs(getSafeCharacter():GetDescendants()) do
                if part:IsA("BasePart") then
                    part.CanCollide = false
                end
            end
        end
    end)
end

-- ESP function
local function enableESP()
    if espEnabled then return end
    
    espEnabled = true
    ESPButton.Text = "üëÅÔ∏è Player ESP: ON"
    ESPButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
    
    local function createESP(player)
        if player == LocalPlayer then return end
        
        local highlight = Instance.new("Highlight")
        highlight.Name = "ESP_" .. player.Name
        highlight.FillColor = Color3.fromRGB(255, 0, 0)
        highlight.OutlineColor = Color3.fromRGB(255, 255, 255)
        highlight.FillTransparency = 0.5
        highlight.OutlineTransparency = 0
        highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
        
        espHighlight[player] = highlight
        
        local function attachESP(character)
            if character then
                highlight.Adornee = character
                highlight.Parent = character
            end
        end
        
        if player.Character then
            attachESP(player.Character)
        end
        
        player.CharacterAdded:Connect(attachESP)
    end
    
    -- Create ESP for existing players
    for _, player in pairs(Players:GetPlayers()) do
        createESP(player)
    end
    
    -- Create ESP for new players
    Players.PlayerAdded:Connect(createESP)
end

-- Speed Hack functionality (Enhanced)
SpeedButton.MouseButton1Click:Connect(function()
    speedEnabled = not speedEnabled
    local character = getSafeCharacter()
    
    if character and character:FindFirstChildOfClass("Humanoid") then
        if speedEnabled then
            SpeedButton.Text = "üöÄ Speed Hack: ON"
            SpeedButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
            character.Humanoid.WalkSpeed = 100 -- Increased speed
            StatusLabel.Text = "Status: Speed Hack Active (100)"
        else
            SpeedButton.Text = "üöÄ Speed Hack: OFF"
            SpeedButton.BackgroundColor3 = Color3.fromRGB(80, 120, 200)
            character.Humanoid.WalkSpeed = 16
            StatusLabel.Text = "Status: Speed Hack Disabled"
        end
    end
end)

-- Infinite Jump functionality (Enhanced)
JumpButton.MouseButton1Click:Connect(function()
    jumpEnabled = not jumpEnabled
    
    if jumpEnabled then
        JumpButton.Text = "üîÑ Infinite Jump: ON"
        JumpButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        StatusLabel.Text = "Status: Infinite Jump Active"
        
        -- Enhanced jump with bypass
        local jumpConnection
        jumpConnection = UserInputService.JumpRequest:Connect(function()
            if jumpEnabled and getSafeCharacter() then
                local humanoid = getSafeCharacter().Humanoid
                humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end)
        
        -- Auto-reconnect if connection breaks
        coroutine.wrap(function()
            while jumpEnabled do
                wait(1)
                if not jumpConnection.Connected then
                    jumpConnection:Disconnect()
                    break
                end
            end
        end)()
    else
        JumpButton.Text = "üîÑ Infinite Jump: OFF"
        JumpButton.BackgroundColor3 = Color3.fromRGB(80, 120, 200)
        StatusLabel.Text = "Status: Infinite Jump Disabled"
    end
end)

-- Fly functionality (Enhanced)
FlyButton.MouseButton1Click:Connect(function()
    flyEnabled = not flyEnabled
    local character = getSafeCharacter()
    
    if flyEnabled then
        FlyButton.Text = "‚úàÔ∏è Fly Mode: ON"
        FlyButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        StatusLabel.Text = "Status: Fly Mode Active"
        
        if character then
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.PlatformStand = true
            end
            
            -- Enhanced flying with better controls
            bv = Instance.new("BodyVelocity")
            bv.Name = "FlyVelocity"
            bv.MaxForce = Vector3.new(400000, 400000, 400000)
            bv.Velocity = Vector3.new(0, 0, 0)
            bv.Parent = character:FindFirstChild("HumanoidRootPart") or character:WaitForChild("HumanoidRootPart")
            
            bg = Instance.new("BodyGyro")
            bg.Name = "FlyGyro"
            bg.MaxTorque = Vector3.new(400000, 400000, 400000)
            bg.P = 100000
            bg.D = 1000
            bg.Parent = character:FindFirstChild("HumanoidRootPart") or character:WaitForChild("HumanoidRootPart")
            
            -- Enhanced fly controls
            local flyConnection
            flyConnection = RunService.Heartbeat:Connect(function()
                if not flyEnabled or not character then
                    flyConnection:Disconnect()
                    return
                end
                
                local root = character:FindFirstChild("HumanoidRootPart")
                if not root then return end
                
                bg.CFrame = workspace.CurrentCamera.CoordinateFrame
                
                local velocity = Vector3.new(0, 0, 0)
                if UserInputService:IsKeyDown(Enum.KeyCode.W) then
                    velocity = velocity + (workspace.CurrentCamera.CFrame.LookVector * flySpeed)
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.S) then
                    velocity = velocity + (workspace.CurrentCamera.CFrame.LookVector * -flySpeed)
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.A) then
                    velocity = velocity + (workspace.CurrentCamera.CFrame.RightVector * -flySpeed)
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.D) then
                    velocity = velocity + (workspace.CurrentCamera.CFrame.RightVector * flySpeed)
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.Space) then
                    velocity = velocity + Vector3.new(0, flySpeed, 0)
                end
                if UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
                    velocity = velocity + Vector3.new(0, -flySpeed, 0)
                end
                
                bv.Velocity = velocity
            end)
        end
    else
        FlyButton.Text = "‚úàÔ∏è Fly Mode: OFF"
        FlyButton.BackgroundColor3 = Color3.fromRGB(80, 120, 200)
        StatusLabel.Text = "Status: Fly Mode Disabled"
        
        if character then
            local humanoid = character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid.PlatformStand = false
            end
        end
        
        if bv then bv:Destroy() end
        if bg then bg:Destroy() end
    end
end)

-- Noclip functionality
NoclipButton.MouseButton1Click:Connect(function()
    noclipEnabled = not noclipEnabled
    
    if noclipEnabled then
        enableNoclip()
        StatusLabel.Text = "Status: Noclip Active"
    else
        NoclipButton.Text = "üëª Noclip: OFF"
        NoclipButton.BackgroundColor3 = Color3.fromRGB(120, 80, 200)
        StatusLabel.Text = "Status: Noclip Disabled"
        
        if noclipConnection then
            noclipConnection:Disconnect()
        end
    end
end)

-- Bypass functionality
BypassButton.MouseButton1Click:Connect(function()
    bypassEnabled = not bypassEnabled
    
    if bypassEnabled then
        enableBypass()
    else
        BypassButton.Text = "üõ°Ô∏è Anti-Cheat Bypass: OFF"
        BypassButton.BackgroundColor3 = Color3.fromRGB(200, 100, 50)
        StatusLabel.Text = "Status: Bypass Disabled"
    end
end)

-- ESP functionality
ESPButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    
    if espEnabled then
        enableESP()
        StatusLabel.Text = "Status: ESP Active"
    else
        ESPButton.Text = "üëÅÔ∏è Player ESP: OFF"
        ESPButton.BackgroundColor3 = Color3.fromRGB(80, 200, 120)
        StatusLabel.Text = "Status: ESP Disabled"
        
        -- Remove all ESP highlights
        for player, highlight in pairs(espHighlight) do
            highlight:Destroy()
        end
        espHighlight = {}
    end
end)

-- Load Morph Tower script functionality (Enhanced)
MorphTowerButton.MouseButton1Click:Connect(function()
    MorphTowerButton.Text = "üîÑ Loading..."
    MorphTowerButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    
    local success, err = pcall(function()
        -- Load the updated Morph Tower script
        loadstring(game:HttpGet("https://pastefy.app/Ym8SMwi5/raw"))()
    end)
    
    if success then
        MorphTowerButton.Text = "‚úÖ Loaded Successfully!"
        MorphTowerButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        StatusLabel.Text = "Status: Morph Tower Script Loaded"
    else
        MorphTowerButton.Text = "‚ùå Error Loading Script"
        MorphTowerButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
        StatusLabel.Text = "Status: Script Load Failed"
        warn("Script loading failed: " .. tostring(err))
    end
    
    wait(3)
    MorphTowerButton.Text = "üè∞ Load Morph Tower Script"
    MorphTowerButton.BackgroundColor3 = Color3.fromRGB(200, 120, 80)
end)

-- Load external script functionality (Enhanced)
LoadButton.MouseButton1Click:Connect(function()
    LoadButton.Text = "üîÑ Loading..."
    LoadButton.BackgroundColor3 = Color3.fromRGB(100, 100, 100)
    
    local success, err = pcall(function()
        -- Enhanced script loading with multiple sources
        StatusLabel.Text = "Status: Loading External Script..."
        
        -- You can add your trusted script URLs here
        -- Example: loadstring(game:HttpGet("YOUR_TRUSTED_SCRIPT_URL"))()
        
        -- For now, just simulate loading
        wait(1)
        return true
    end)
    
    if success then
        LoadButton.Text = "‚úÖ Loaded Successfully!"
        LoadButton.BackgroundColor3 = Color3.fromRGB(50, 200, 50)
        StatusLabel.Text = "Status: External Script Loaded"
    else
        LoadButton.Text = "‚ùå Error Loading Script"
        LoadButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
        StatusLabel.Text = "Status: External Script Failed"
        warn("External script loading failed: " .. tostring(err))
    end
    
    wait(3)
    LoadButton.Text = "üìÇ Load External Script"
    LoadButton.BackgroundColor3 = Color3.fromRGB(120, 80, 200)
end)

-- Auto-cleanup on respawn (Enhanced)
LocalPlayer.CharacterAdded:Connect(function(character)
    -- Wait for character to fully load
    character:WaitForChild("Humanoid")
    
    -- Reset states but keep settings
    if speedEnabled then
        wait(1)
        local humanoid = character:FindFirstChildOfClass("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = 100
        end
    end
    
    if flyEnabled then
        flyEnabled = false
        FlyButton.Text = "‚úàÔ∏è Fly Mode: OFF"
        FlyButton.BackgroundColor3 = Color3.fromRGB(80, 120, 200)
        if bv then bv:Destroy() end
        if bg then bg:Destroy() end
    end
    
    if noclipEnabled then
        noclipEnabled = false
        NoclipButton.Text = "üëª Noclip: OFF"
        NoclipButton.BackgroundColor3 = Color3.fromRGB(120, 80, 200)
        if noclipConnection then
            noclipConnection:Disconnect()
        end
    end
    
    StatusLabel.Text = "Status: Character Respawned - V3 Active"
end)

-- Error handling and protection
coroutine.wrap(function()
    while true do
        wait(5)
        StatusLabel.Text = "Status: V3 System Active | Protected"
        
        -- Auto-reapply features if they get reset
        if speedEnabled and getSafeCharacter() then
            local humanoid = getSafeCharacter().Humanoid
            if humanoid.WalkSpeed ~= 100 then
                humanoid.WalkSpeed = 100
            end
        end
    end
end)()

print("‚ö° POWERFUL V3 GUI LOADED SUCCESSFULLY! ‚ö°")
print("üî• Made by Roblox Hacks 404 üî•")
print("üõ°Ô∏è Bypass System: Active")
print("üöÄ Enhanced Features: Ready")
print("üéØ Error Protection: Enabled")